<VirtualHost *:80>
    ServerName  ${userdata:servername}
    ServerAlias ${userdata:serveralias}

    <Location />
        Redirect 301 / https://${userdata:servername}
    </Location>

</VirtualHost>

<VirtualHost *:443>
    ServerName  ${userdata:servername}
    ServerAlias ${userdata:serveralias}
    ServerAdmin ${userdata:serveradmin}

    SuexecUserGroup ${userdata:name} ${userdata:name}
    AddHandler fcgid-script .php

    DocumentRoot "${buildout:directory}/htdocs"
    DirectoryIndex index.htm index.html index.php

    <Directory />
        Options -Indexes FollowSymLinks
    </Directory>

    <Directory "${buildout:directory}/htdocs">
        Options -Indexes MultiViews FollowSymLinks +ExecCGI
        
        FCGIWrapper ${buildout:directory}/bin/php-fcgi-starter .php
       
        RewriteEngine on
        # yii rewrite settings:
        # if a directory or a file exists, use it directly
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # otherwise forward it to index.php
        RewriteRule . index.php

        Order allow,deny
        allow from all
    </Directory>
    
    ErrorLog ${buildout:directory}/logs/error.log
    LogLevel warn
    CustomLog ${buildout:directory}/logs/access.log combined
    ServerSignature On
 
    SSLEngine on
    SSLCertificateFile ${userdata:ssl_cert}

</VirtualHost>

